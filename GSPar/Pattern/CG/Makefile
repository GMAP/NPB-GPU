SHELL=/bin/sh

CLASS=S
BENCHMARK=cg
BENCHMARKU=CG
PARAMETERS=setparams

# Defining the GPU backend
GPU_DRIVER=OPENCL
DRIVER_FLAG=-DGSPARDRIVER_OPENCL
ifeq ($(GPU_DRIVER),CUDA)
	DRIVER_FLAG=-DGSPARDRIVER_CUDA
endif

include ../config/make.def

COMPILE_CG=$(CC) $(DRIVER_FLAG) $(BENCHMARK).cpp $(CFLAGS) $(GSPARLIB) -DCLASS_$(CLASS) -o $(BENCHMARK).$(CLASS)
SET_PARAMETERS=$(CC) $(SYSDIR)/$(PARAMETERS).cpp -o $(PARAMETERS) && ./$(PARAMETERS) $(BENCHMARK) $(CLASS)
MOVE_BINARIES=mv $(BENCHMARK).$(CLASS) $(BINDIR) && mv $(PARAMETERS) $(SYSDIR)

$(BENCHMARK):
	$(SET_PARAMETERS) && $(COMPILE_CG) && $(MOVE_BINARIES)

clean:
	- rm -f *.o *~ 
	- rm -f npbparams.hpp core